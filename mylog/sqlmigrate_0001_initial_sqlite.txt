BEGIN;
--
-- Create model Curator
--
CREATE TABLE "Curator" ("name" varchar(35) NOT NULL, "last_name" varchar(35) NOT NULL, "patronymic" varchar(35) NOT NULL, "description" varchar(200) NOT NULL, "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT);
--
-- Create model Skill
--
CREATE TABLE "Skill" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(100) NOT NULL);
--
-- Create model Student
--
CREATE TABLE "Student" ("name" varchar(35) NOT NULL, "last_name" varchar(35) NOT NULL, "patronymic" varchar(35) NOT NULL, "description" varchar(200) NOT NULL, "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT);
CREATE TABLE "Student_skills" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "student_id" integer NOT NULL REFERENCES "Student" ("id") DEFERRABLE INITIALLY DEFERRED, "skill_id" integer NOT NULL REFERENCES "Skill" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model Subject
--
CREATE TABLE "Subject" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(100) NOT NULL);
--
-- Create model SuggestionTheme
--
CREATE TABLE "Suggestion_theme" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_creation" datetime NOT NULL, "curator_id" integer NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model SuggestionThemeComment
--
CREATE TABLE "Suggestion_theme_comment" ("author_name" varchar(35) NOT NULL, "content" varchar(200) NOT NULL, "date_creation" datetime NOT NULL, "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "suggestion_id" integer NOT NULL REFERENCES "Suggestion_theme" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model SuggestionThemeProgress
--
CREATE TABLE "Suggestion_theme_progress" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(75) NOT NULL, "description" varchar(150) NOT NULL, "date_update" datetime NULL);
--
-- Create model SuggestionThemeStatus
--
CREATE TABLE "Suggestion_theme_status" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(50) NOT NULL);
--
-- Create model Theme
--
CREATE TABLE "Theme" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(100) NOT NULL, "description" varchar(250) NOT NULL, "date_creation" datetime NOT NULL, "date_acceptance" datetime NULL, "curator_id" integer NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED, "student_id" integer NULL REFERENCES "Student" ("id") DEFERRABLE INITIALLY DEFERRED, "subject_id" integer NULL REFERENCES "Subject" ("id") DEFERRABLE INITIALLY DEFERRED);
CREATE TABLE "Theme_skills" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "theme_id" integer NOT NULL REFERENCES "Theme" ("id") DEFERRABLE INITIALLY DEFERRED, "skill_id" integer NOT NULL REFERENCES "Skill" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model Work
--
CREATE TABLE "Work" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_start" datetime NOT NULL, "date_finish" datetime NULL, "theme_id" integer NOT NULL REFERENCES "Theme" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model WorkStep
--
CREATE TABLE "Work_step" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(100) NOT NULL, "description" varchar(250) NOT NULL, "date_start" datetime NOT NULL, "date_finish" datetime NOT NULL);
--
-- Create model WorkStepComment
--
CREATE TABLE "Work_step_comment" ("author_name" varchar(35) NOT NULL, "content" varchar(200) NOT NULL, "date_creation" datetime NOT NULL, "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "work_step_id" integer NOT NULL REFERENCES "Work_step" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model WorkStepMaterial
--
CREATE TABLE "Work_step_material" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "content" varchar(200) NOT NULL, "step_id" integer NOT NULL REFERENCES "Work_step" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model WorkStepStatus
--
CREATE TABLE "Work_step_status" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" varchar(50) NOT NULL);
--
-- Add field status to workstep
--
ALTER TABLE "Work_step" RENAME TO "Work_step__old";
CREATE TABLE "Work_step" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(100) NOT NULL, "description" varchar(250) NOT NULL, "date_start" datetime NOT NULL, "date_finish" datetime NOT NULL, "status_id" integer NOT NULL REFERENCES "Work_step_status" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "Work_step" ("id", "title", "description", "date_start", "date_finish", "status_id") SELECT "id", "title", "description", "date_start", "date_finish", NULL FROM "Work_step__old";
DROP TABLE "Work_step__old";
CREATE UNIQUE INDEX "Student_skills_student_id_skill_id_3a1e7fc9_uniq" ON "Student_skills" ("student_id", "skill_id");
CREATE INDEX "Student_skills_student_id_4cf86b59" ON "Student_skills" ("student_id");
CREATE INDEX "Student_skills_skill_id_5e48bf79" ON "Student_skills" ("skill_id");
CREATE INDEX "Suggestion_theme_curator_id_0a36d856" ON "Suggestion_theme" ("curator_id");
CREATE INDEX "Suggestion_theme_comment_suggestion_id_9dd9fc98" ON "Suggestion_theme_comment" ("suggestion_id");
CREATE INDEX "Theme_curator_id_b807b49a" ON "Theme" ("curator_id");
CREATE INDEX "Theme_student_id_56dd59b2" ON "Theme" ("student_id");
CREATE INDEX "Theme_subject_id_24550eb8" ON "Theme" ("subject_id");
CREATE UNIQUE INDEX "Theme_skills_theme_id_skill_id_1b4ec720_uniq" ON "Theme_skills" ("theme_id", "skill_id");
CREATE INDEX "Theme_skills_theme_id_46898d65" ON "Theme_skills" ("theme_id");
CREATE INDEX "Theme_skills_skill_id_c455e883" ON "Theme_skills" ("skill_id");
CREATE INDEX "Work_theme_id_eaade071" ON "Work" ("theme_id");
CREATE INDEX "Work_step_comment_work_step_id_ecc2d35e" ON "Work_step_comment" ("work_step_id");
CREATE INDEX "Work_step_material_step_id_c722cd5f" ON "Work_step_material" ("step_id");
CREATE INDEX "Work_step_status_id_e8a0c444" ON "Work_step" ("status_id");
--
-- Add field work to workstep
--
ALTER TABLE "Work_step" RENAME TO "Work_step__old";
CREATE TABLE "Work_step" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(100) NOT NULL, "description" varchar(250) NOT NULL, "date_start" datetime NOT NULL, "date_finish" datetime NOT NULL, "status_id" integer NOT NULL REFERENCES "Work_step_status" ("id") DEFERRABLE INITIALLY DEFERRED, "work_id" integer NOT NULL REFERENCES "Work" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "Work_step" ("id", "title", "description", "date_start", "date_finish", "status_id", "work_id") SELECT "id", "title", "description", "date_start", "date_finish", "status_id", NULL FROM "Work_step__old";
DROP TABLE "Work_step__old";
CREATE INDEX "Work_step_status_id_e8a0c444" ON "Work_step" ("status_id");
CREATE INDEX "Work_step_work_id_fd227757" ON "Work_step" ("work_id");
--
-- Add field progress to suggestiontheme
--
ALTER TABLE "Suggestion_theme" RENAME TO "Suggestion_theme__old";
CREATE TABLE "Suggestion_theme" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_creation" datetime NOT NULL, "curator_id" integer NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED, "progress_id" integer NULL REFERENCES "Suggestion_theme_progress" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "Suggestion_theme" ("id", "date_creation", "curator_id", "progress_id") SELECT "id", "date_creation", "curator_id", NULL FROM "Suggestion_theme__old";
DROP TABLE "Suggestion_theme__old";
CREATE INDEX "Suggestion_theme_curator_id_0a36d856" ON "Suggestion_theme" ("curator_id");
CREATE INDEX "Suggestion_theme_progress_id_94e6bd86" ON "Suggestion_theme" ("progress_id");
--
-- Add field status to suggestiontheme
--
ALTER TABLE "Suggestion_theme" RENAME TO "Suggestion_theme__old";
CREATE TABLE "Suggestion_theme" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_creation" datetime NOT NULL, "curator_id" integer NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED, "progress_id" integer NULL REFERENCES "Suggestion_theme_progress" ("id") DEFERRABLE INITIALLY DEFERRED, "status_id" integer NOT NULL REFERENCES "Suggestion_theme_status" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "Suggestion_theme" ("id", "date_creation", "curator_id", "progress_id", "status_id") SELECT "id", "date_creation", "curator_id", "progress_id", NULL FROM "Suggestion_theme__old";
DROP TABLE "Suggestion_theme__old";
CREATE INDEX "Suggestion_theme_curator_id_0a36d856" ON "Suggestion_theme" ("curator_id");
CREATE INDEX "Suggestion_theme_progress_id_94e6bd86" ON "Suggestion_theme" ("progress_id");
CREATE INDEX "Suggestion_theme_status_id_600846c8" ON "Suggestion_theme" ("status_id");
--
-- Add field student to suggestiontheme
--
ALTER TABLE "Suggestion_theme" RENAME TO "Suggestion_theme__old";
CREATE TABLE "Suggestion_theme" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_creation" datetime NOT NULL, "curator_id" integer NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED, "progress_id" integer NULL REFERENCES "Suggestion_theme_progress" ("id") DEFERRABLE INITIALLY DEFERRED, "status_id" integer NOT NULL REFERENCES "Suggestion_theme_status" ("id") DEFERRABLE INITIALLY DEFERRED, "student_id" integer NULL REFERENCES "Student" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "Suggestion_theme" ("id", "date_creation", "curator_id", "progress_id", "status_id", "student_id") SELECT "id", "date_creation", "curator_id", "progress_id", "status_id", NULL FROM "Suggestion_theme__old";
DROP TABLE "Suggestion_theme__old";
CREATE INDEX "Suggestion_theme_curator_id_0a36d856" ON "Suggestion_theme" ("curator_id");
CREATE INDEX "Suggestion_theme_progress_id_94e6bd86" ON "Suggestion_theme" ("progress_id");
CREATE INDEX "Suggestion_theme_status_id_600846c8" ON "Suggestion_theme" ("status_id");
CREATE INDEX "Suggestion_theme_student_id_27921146" ON "Suggestion_theme" ("student_id");
--
-- Add field theme to suggestiontheme
--
ALTER TABLE "Suggestion_theme" RENAME TO "Suggestion_theme__old";
CREATE TABLE "Suggestion_theme" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "date_creation" datetime NOT NULL, "curator_id" integer NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED, "progress_id" integer NULL REFERENCES "Suggestion_theme_progress" ("id") DEFERRABLE INITIALLY DEFERRED, "status_id" integer NOT NULL REFERENCES "Suggestion_theme_status" ("id") DEFERRABLE INITIALLY DEFERRED, "student_id" integer NULL REFERENCES "Student" ("id") DEFERRABLE INITIALLY DEFERRED, "theme_id" integer NOT NULL REFERENCES "Theme" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "Suggestion_theme" ("id", "date_creation", "curator_id", "progress_id", "status_id", "student_id", "theme_id") SELECT "id", "date_creation", "curator_id", "progress_id", "status_id", "student_id", NULL FROM "Suggestion_theme__old";
DROP TABLE "Suggestion_theme__old";
CREATE INDEX "Suggestion_theme_curator_id_0a36d856" ON "Suggestion_theme" ("curator_id");
CREATE INDEX "Suggestion_theme_progress_id_94e6bd86" ON "Suggestion_theme" ("progress_id");
CREATE INDEX "Suggestion_theme_status_id_600846c8" ON "Suggestion_theme" ("status_id");
CREATE INDEX "Suggestion_theme_student_id_27921146" ON "Suggestion_theme" ("student_id");
CREATE INDEX "Suggestion_theme_theme_id_a5cdf114" ON "Suggestion_theme" ("theme_id");
--
-- Add field skills to curator
--
CREATE TABLE "Curator_skills" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "curator_id" integer NOT NULL REFERENCES "Curator" ("id") DEFERRABLE INITIALLY DEFERRED, "skill_id" integer NOT NULL REFERENCES "Skill" ("id") DEFERRABLE INITIALLY DEFERRED);
CREATE UNIQUE INDEX "Curator_skills_curator_id_skill_id_caa89ac3_uniq" ON "Curator_skills" ("curator_id", "skill_id");
CREATE INDEX "Curator_skills_curator_id_e56cbb05" ON "Curator_skills" ("curator_id");
CREATE INDEX "Curator_skills_skill_id_fec572d0" ON "Curator_skills" ("skill_id");
COMMIT;
